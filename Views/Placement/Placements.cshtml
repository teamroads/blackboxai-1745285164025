@model PlacementApp.Models.PlacementInfo

@{
    ViewData["Title"] = "Placement Info";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<h2 class="text-3xl font-semibold mb-6">Placement Info</h2>

@if (ViewBag.Message != null)
{
    <div class="mb-4 p-4 bg-green-100 text-green-700 rounded">
        @ViewBag.Message
    </div>
}

<form asp-action="PlacementInfo" method="post" class="max-w-4xl" id="placementInfoForm">
    <table class="min-w-full divide-y divide-gray-200 border border-gray-300 rounded">
        <tbody class="bg-white divide-y divide-gray-200">
            <tr>
                <td class="px-6 py-4 font-medium text-gray-700 w-1/3">Candidate Name</td>
                <td class="px-6 py-4">
                    <input asp-for="CandidateName" class="w-full rounded border-gray-300 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-200 focus:ring-opacity-50" />
                    <span asp-validation-for="CandidateName" class="text-red-600 text-sm"></span>
                </td>
            </tr>
            <tr>
                <td class="px-6 py-4 font-medium text-gray-700">Phone Number</td>
                <td class="px-6 py-4">
                    <input asp-for="PhoneNumber" class="w-full rounded border-gray-300 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-200 focus:ring-opacity-50" />
                    <span asp-validation-for="PhoneNumber" class="text-red-600 text-sm"></span>
                </td>
            </tr>
            <tr>
                <td class="px-6 py-4 font-medium text-gray-700">Email ID</td>
                <td class="px-6 py-4">
                    <input asp-for="EmailID" class="w-full rounded border-gray-300 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-200 focus:ring-opacity-50" />
                    <span asp-validation-for="EmailID" class="text-red-600 text-sm"></span>
                </td>
            </tr>
            <tr>
                <td class="px-6 py-4 font-medium text-gray-700">Visa Status</td>
                <td class="px-6 py-4">
                    <input asp-for="VisaStatus" class="w-full rounded border-gray-300 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-200 focus:ring-opacity-50" />
                    <span asp-validation-for="VisaStatus" class="text-red-600 text-sm"></span>
                </td>
            </tr>
            <tr>
                <td class="px-6 py-4 font-medium text-gray-700">Current Location</td>
                <td class="px-6 py-4">
                    <input asp-for="CurrentLocation" class="w-full rounded border-gray-300 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-200 focus:ring-opacity-50" />
                    <span asp-validation-for="CurrentLocation" class="text-red-600 text-sm"></span>
                </td>
            </tr>
            <tr>
                <td class="px-6 py-4 font-medium text-gray-700">Client Name</td>
                <td class="px-6 py-4">
                    <input asp-for="ClientName" class="w-full rounded border-gray-300 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-200 focus:ring-opacity-50" />
                    <span asp-validation-for="ClientName" class="text-red-600 text-sm"></span>
                </td>
            </tr>
            <tr>
                <td class="px-6 py-4 font-medium text-gray-700">Role Title</td>
                <td class="px-6 py-4">
                    <input asp-for="RoleTitle" class="w-full rounded border-gray-300 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-200 focus:ring-opacity-50" />
                    <span asp-validation-for="RoleTitle" class="text-red-600 text-sm"></span>
                </td>
            </tr>
            <tr>
                <td class="px-6 py-4 font-medium text-gray-700">Project Location</td>
                <td class="px-6 py-4">
                    <input asp-for="ProjectLocation" class="w-full rounded border-gray-300 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-200 focus:ring-opacity-50" />
                    <span asp-validation-for="ProjectLocation" class="text-red-600 text-sm"></span>
                </td>
            </tr>
            <tr>
                <td class="px-6 py-4 font-medium text-gray-700">Employer Name</td>
                <td class="px-6 py-4">
                    <input asp-for="EmployerName" class="w-full rounded border-gray-300 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-200 focus:ring-opacity-50" />
                    <span asp-validation-for="EmployerName" class="text-red-600 text-sm"></span>
                </td>
            </tr>
            <tr>
                <td class="px-6 py-4 font-medium text-gray-700">Employer POC</td>
                <td class="px-6 py-4">
                    <input asp-for="EmployerPOC" class="w-full rounded border-gray-300 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-200 focus:ring-opacity-50" />
                    <span asp-validation-for="EmployerPOC" class="text-red-600 text-sm"></span>
                </td>
            </tr>
            <tr>
                <td class="px-6 py-4 font-medium text-gray-700">Employer Email</td>
                <td class="px-6 py-4">
                    <input asp-for="EmployerEmail" class="w-full rounded border-gray-300 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-200 focus:ring-opacity-50" />
                    <span asp-validation-for="EmployerEmail" class="text-red-600 text-sm"></span>
                </td>
            </tr>
            <tr>
                <td class="px-6 py-4 font-medium text-gray-700">Employer Phone</td>
                <td class="px-6 py-4">
                    <input asp-for="EmployerPhone" class="w-full rounded border-gray-300 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-200 focus:ring-opacity-50" />
                    <span asp-validation-for="EmployerPhone" class="text-red-600 text-sm"></span>
                </td>
            </tr>
            <tr>
                <td class="px-6 py-4 font-medium text-gray-700">Type of Hire</td>
                <td class="px-6 py-4">
                    <select asp-for="TypeOfHire" class="w-full rounded border-gray-300 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-200 focus:ring-opacity-50" id="typeOfHire">
                        <option value="">Select Type of Hire</option>
                        <option value="Contract - W2">Contract - W2</option>
                        <option value="Contract - C2C">Contract - C2C</option>
                        <option value="Fulltime">Fulltime</option>
                    </select>
                    <span asp-validation-for="TypeOfHire" class="text-red-600 text-sm"></span>
                </td>
            </tr>
            <tr>
                <td class="px-6 py-4 font-medium text-gray-700">Apply Referral</td>
                <td class="px-6 py-4">
                    <select asp-for="ApplyReferral" class="w-full rounded border-gray-300 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-200 focus:ring-opacity-50" id="applyReferral" disabled>
                        <option value="">Select</option>
                        <option value="true">Yes</option>
                        <option value="false">No</option>
                    </select>
                    <span asp-validation-for="ApplyReferral" class="text-red-600 text-sm"></span>
                </td>
            </tr>
            <tr>
                <td class="px-6 py-4 font-medium text-gray-700">Referral Fees</td>
                <td class="px-6 py-4">
                    <input asp-for="ReferralFees" class="w-full rounded border-gray-300 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-200 focus:ring-opacity-50" id="referralFees" disabled />
                    <span asp-validation-for="ReferralFees" class="text-red-600 text-sm"></span>
                </td>
            </tr>
            <tr>
                <td class="px-6 py-4 font-medium text-gray-700">Pay Rate</td>
                <td class="px-6 py-4">
                    <input asp-for="PayRate" type="number" step="0.01" class="w-full rounded border-gray-300 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-200 focus:ring-opacity-50" id="payRate" />
                    <span asp-validation-for="PayRate" class="text-red-600 text-sm"></span>
                </td>
            </tr>
            <tr>
                <td class="px-6 py-4 font-medium text-gray-700">SRP</td>
                <td class="px-6 py-4">
                    <input asp-for="SRP" type="number" step="0.01" class="w-full rounded border-gray-300 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-200 focus:ring-opacity-50" id="srp" />
                    <span asp-validation-for="SRP" class="text-red-600 text-sm"></span>
                </td>
            </tr>
            <tr>
                <td class="px-6 py-4 font-medium text-gray-700">Margin</td>
                <td class="px-6 py-4">
                    <input asp-for="Margin" type="number" step="0.01" class="w-full rounded border-gray-300 shadow-sm bg-gray-100 cursor-not-allowed" id="margin" readonly />
                    <span asp-validation-for="Margin" class="text-red-600 text-sm"></span>
                </td>
            </tr>
            <tr>
                <td class="px-6 py-4 font-medium text-gray-700">Recruiter's Name</td>
                <td class="px-6 py-4">
                    <input asp-for="RecruiterName" class="w-full rounded border-gray-300 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-200 focus:ring-opacity-50" />
                    <span asp-validation-for="RecruiterName" class="text-red-600 text-sm"></span>
                </td>
            </tr>
        </tbody>
    </table>

    <div class="mt-6">
        <button type="submit" class="px-6 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition">Save</button>
    </div>
</form>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const typeOfHire = document.getElementById('typeOfHire');
            const applyReferral = document.getElementById('applyReferral');
            const referralFees = document.getElementById('referralFees');
            const payRate = document.getElementById('payRate');
            const srp = document.getElementById('srp');
            const margin = document.getElementById('margin');

            function updateApplyReferral() {
                if (typeOfHire.value === 'Contract - W2' || typeOfHire.value === 'Fulltime') {
                    applyReferral.disabled = false;
                } else {
                    applyReferral.value = '';
                    applyReferral.disabled = true;
                    referralFees.value = '';
                    referralFees.disabled = true;
                }
            }

            function updateReferralFees() {
                if (applyReferral.value === 'true') {
                    referralFees.disabled = false;
                } else {
                    referralFees.value = '';
                    referralFees.disabled = true;
                }
            }

            function updateMargin() {
                const pay = parseFloat(payRate.value);
                const srpVal = parseFloat(srp.value);
                if (!isNaN(pay) && !isNaN(srpVal)) {
                    margin.value = (srpVal - pay).toFixed(2);
                } else {
                    margin.value = '';
                }
            }

            typeOfHire.addEventListener('change', () => {
                updateApplyReferral();
                updateReferralFees();
            });

            applyReferral.addEventListener('change', updateReferralFees);
            payRate.addEventListener('input', updateMargin);
            srp.addEventListener('input', updateMargin);

            // Initialize on page load
            updateApplyReferral();
            updateReferralFees();
            updateMargin();
        });
    </script>
}
